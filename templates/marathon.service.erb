[Unit]
Description=Marathon Scheduler
After=docker.service
Requires=docker.service

[Service]
Type=simple
TimeoutStartSec=0
TimeoutStopSec=10
RestartSec=10
Restart=always
Type=notify
NotifyAccess=all

ExecStartPre=-<%= @docker_path %> rm -f <%= @container_id %>
ExecStartPre=<%= @docker_path %> run --rm --privileged -v /opt/bin:/opt/bin cellos/systemd-docker
ExecStartPre=<%= @docker_path %> pull <%= @registry %>:<%= @version %>
ExecStart=/opt/bin/systemd-docker --cgroups name=systemd run --rm \
 --name <%= @container_id %> \
 --net=host
 -p <%= @port %>:<%= @port %> \
 -e MARATHON_MASTER=<%= @master %> \
 -e MARATHON_ZK=<%= @zk %> \
 -e MARATHON_HTTP_PORT=<%= @port %> \
 -e HOSTNAME=<%= @hostname %> \
 <%= @registry %>:<%= @version %> \

 ExecStopPost=-<%= @docker_path %> rm -f <%= @container_id %>

[Install]
WantedBy=multi-user.target
